<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/core-input/core-input.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<polymer-element name="g-cas" no-script>
<template>
<a href="https://services.geodan.nl/cas/login?service=http://steveno.geodan.nl/2015/pico">login</a>
</template>
<script>

Polymer({
  ready: function() {
  }
  });
</script>
  
<!--template>
<style>
#login {
    background: #3F51B5;
    color: white;
}
#login[disabled] {
    background: #ececec;
}
</style>
<iframe style="display:none" src="https://services.geodan.nl/geocas/whoami.jsp"></iframe>
<core-ajax method="post" id="ajaxRequest"
    auto
    url="{{url}}"
    params="{{params}}" 
   withCredentials=true body='lt=%24%7BloginTicket%7D&username=steven%40geodan.nl&password={{password}}&service=http%3A%2F%2Fsteveno.geodan.nl%2F2015%2Fpico%2F%3F&auto=true'
    handleAs="document"
    on-core-response="{{handleResponse}}"></core-ajax>
<paper-input-decorator floatingLabel='true' id="piduser" label="Gebruikersnaam" error="Gebruikersnaam is een email adres"><input tabindex="1" autofocus id="i_username" on-blur="{{validate}}" is="core-input" value="{{username}}" type="email"/></paper-input-decorator>
<paper-input-decorator floatingLabel='true' label="Wachtwoord" error="Wachtwoord is verplicht">
<input  tabindex="2" is="core-input" on-blur="{{validate}}" value="{{password}}" type="password"/>
</paper-input-decorator>
<paper-button >annuleer</paper-button><paper-button  disabled on-click="{{loginGeodan}}" id="login" disabled raised>login</paper-button>
</template>
<script>

Polymer({
  ready: function() {
    
  },
  loginGeodan: function() {
     var statics = {
				DEFAULT_CAS_SERVER: 'https://services.geodan.nl/',
				DEFAULT_WHO_AM_I: 'geocas/whoami.jsp',
				DEFAULT_LOGOUT_URL: 'https://services.geodan.nl/cas/logout',
				DEFAULT_FORWARD_URL_PARAMETER: '?forwardUrl=',
				DEFAULT_FORWARD_URL: 'http://www.geodan.nl'
			}
     var u = this.username = 'steven@geodan.nl';
     var p = this.password = 'geodan123';
     var url = "https://services.geodan.nl/cas/login";
     var params = {};
     params.method = "POST";
     params.withCredentials = true;
     params.username = u;
     params.password = p;
     params.lt = "${loginTicket}";
     params.auto = true;
     params.service = "http://steveno.geodan.nl/2015/pico/";
     this.params = params;
     this.$.ajaxRequest.url = url;
     this.$.ajaxRequest.go();
   /*  this.$.ajaxRequest.request({url: url, params: params, callback: function(d){
        console.log(d);
     }});*/
     
     
  },
  handleResponse: function(e) {
    console.log(e);
  },
  validate: function(e){
    if(e.target.value==''||e.target.value===undefined||!e.target.validity.valid)
    e.target.parentElement.isInvalid = true;
    else
    e.target.parentElement.isInvalid = false;
    if(this.username&&this.password&&this.$.i_username.validity.valid) {
        this.$.login.disabled = false;
        this.$.login.tabIndex = 3;
        this.$.login.focus();
    }
  },
  usernameChanged: function(){
    console.log(' changed' );
  }
});
</script-->
</polymer-element>
